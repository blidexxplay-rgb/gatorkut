<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catkut üêæ</title>
<style>
:root{
  --rosa:#f48fb1;
  --rosa2:#f06292;
  --bg:#fff0f5;
  --card:#ffffffdd;
  --dark-bg:#1e1e1e;
  --dark-card:#2a2a2add;
  --dark-text:#fff;
  --friend-bg:#ffe0b2; /* Cor clara para amigos */
  --friend-dark-bg:#444; /* Cor escura para amigos */
}
*{box-sizing:border-box;}
body{margin:0;font-family:"Segoe UI",sans-serif;background:var(--bg);transition:0.3s;color:#333;}
.dark body{background:var(--dark-bg);color:var(--dark-text);}
.hidden{display:none;}
.center{display:flex;justify-content:center;align-items:center;min-height:100vh;}
.card{background:var(--card);padding:25px;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,.1);width:320px;animation:fade .5s;}
.dark .card{background:var(--dark-card);}
@keyframes fade{from{opacity:0;transform:translateY(20px);}to{opacity:1;}}
input,button,textarea,select{width:100%;padding:10px;margin:8px 0;border-radius:10px;border:1px solid #ccc;font-size:15px;}
.dark input,.dark textarea,.dark select{border:1px solid #555;background:#333;color:#fff;}
button{background:var(--rosa);color:white;border:none;cursor:pointer;font-weight:bold;transition:background .3s;}
button:hover{background:var(--rosa2);}
header{background:var(--rosa);color:#fff;padding:15px;text-align:center;font-size:26px;position:sticky;top:0;z-index:10;}
header small a{color:#fff;text-decoration:underline;}
header span{font-weight:bold;}
nav{background:#fff;display:flex;justify-content:center;gap:20px;padding:10px;flex-wrap:wrap;box-shadow:0 2px 4px rgba(0,0,0,.05);}
.dark nav{background:#222;}
nav a{text-decoration:none;color:var(--rosa2);font-weight:bold;}
main{max-width:900px;margin:20px auto;padding:0 15px;}
.perfil{background:var(--card);border-radius:18px;padding:20px;display:flex;gap:20px;align-items:center;flex-wrap:wrap;box-shadow:0 4px 12px rgba(0,0,0,.1);}
.dark .perfil{background:var(--dark-card);}
.perfil img{width:130px;height:130px;border-radius:50%;object-fit:cover;border:4px solid var(--rosa);}
textarea{border:2px solid var(--rosa);resize:none;}
.scrap{background:var(--card);padding:10px;margin:10px 0;border-left:6px solid var(--rosa);border-radius:12px;box-shadow:0 0 6px rgba(0,0,0,.1);}
.dark .scrap{background:#333;border-left:6px solid var(--rosa);}
.comunidade{display:inline-block;background:var(--rosa);color:#fff;padding:8px 14px;border-radius:20px;margin:5px;box-shadow:0 0 5px rgba(0,0,0,.15);}
.scrap-buttons{display:flex;gap:10px;margin-top:5px;font-size:14px;}
.scrap-buttons button{background:#f06292;padding:5px;border-radius:8px;font-weight:normal;}
#friendList{list-style:none;padding:0;}
#friendList li{
  padding:8px 12px;
  background:var(--friend-bg);
  color:#333;
  margin:5px 0;
  border-radius:6px;
  font-weight:600;
}
.dark #friendList li{
  background:var(--friend-dark-bg);
  color:var(--dark-text);
}
</style>
</head>
<body>

<div id="auth" class="center">
  <div class="card">
    <h2 style="text-align:center">üêæ Catkut</h2>
    <form id="registerForm">
      <h4>Criar Conta</h4>
      <input id="regUser" placeholder="Usu√°rio" required>
      <input id="regPass" type="password" placeholder="Senha" required>
      <button type="submit">Registrar</button>
    </form>
    <form id="loginForm">
      <h4>Entrar</h4>
      <input id="logUser" placeholder="Usu√°rio" required>
      <input id="logPass" type="password" placeholder="Senha" required>
      <button type="submit">Login</button>
    </form>
  </div>
</div>

<div id="app" class="hidden">
  <header>
    üêæ Catkut ‚Äì Rede dos Gatinhos üêæ
    <br><small>Ol√° <span id="userDisplay"></span> | <a href="#" id="logout">Sair</a></small>
    <button id="themeBtn" style="margin-top:5px;">üåô Dark Mode</button>
  </header>

  <nav>
    <a href="#perfil">Meu Gatinho</a>
    <a href="#scrapbook">Mural</a>
    <a href="#comunidades">Comunidades</a>
    <a href="#amigos">Amigos</a>
  </nav>

  <main>
    <section id="perfil" class="perfil">
      <img id="avatar" src="https://placekitten.com/200/200" alt="foto">
      <div>
        <h2 id="userName"></h2>
        <p id="status">Status: üò∏ curtindo catnip!</p>
        <textarea id="bio" placeholder="Escreva sua bio..."></textarea>
        <label>Mudar foto: <input type="file" id="imgUpload" accept="image/*"></label>
      </div>
    </section>

    <section id="scrapbook">
      <h3>Mural de Miaus</h3>
      <form id="scrapForm">
        <textarea id="scrapText" placeholder="Deixe um miau carinhoso..."></textarea>
        <button type="submit">Publicar</button>
      </form>
      <div id="scraps"></div>
    </section>

    <section id="comunidades">
      <h3>Comunidades Felinas</h3>
      <div class="comunidade">Eu ‚ô• Catnip</div>
      <div class="comunidade">Dormir 16h por dia</div>
      <div class="comunidade">Ca√ßadores de Laser</div>
      <div class="comunidade">Caixa de Papel √© Vida</div>
      <div class="comunidade">Ronrons Profundos</div>
    </section>

    <section id="amigos">
      <h3>Amigos</h3>
      <form id="addFriendForm">
        <input id="friendInput" placeholder="Nome do Gatinho (usu√°rio)" required>
        <button type="submit">Adicionar Amigo</button>
      </form>
      <ul id="friendList"></ul>
    </section>
  </main>
</div>

<script>
const $ = id=>document.getElementById(id);
function save(key,obj){localStorage.setItem(key,JSON.stringify(obj));}
function load(key){return JSON.parse(localStorage.getItem(key)||'null');}

// VARI√ÅVEIS GLOBAIS
const USERS_KEY = 'catkutUsers';
let users = load(USERS_KEY) || [];
let currentUser = null;

// --- FUN√á√ïES DE PERSIST√äNCIA E INICIALIZA√á√ÉO ---

// Fun√ß√£o auxiliar para encontrar e atualizar o usu√°rio no array global e localStorage
function updateUser(user){
  const idx = users.findIndex(x=>x.user===user.user);
  if(idx>=0){users[idx]=user; save(USERS_KEY,users);}
}

// Salva o nome de usu√°rio do logado para manter a sess√£o
function saveCurrentUser(user){
  localStorage.setItem('currentUser', user.user);
}

// Carrega o usu√°rio logado da sess√£o
function loadCurrentUser(){
  const username = localStorage.getItem('currentUser');
  if(!username) return null;
  return users.find(x=>x.user===username);
}

// Inicia a aplica√ß√£o ap√≥s o login
function startApp(user){
  currentUser = user;
  saveCurrentUser(user);
  $('auth').classList.add('hidden');
  $('app').classList.remove('hidden');
  $('userDisplay').textContent=user.user;
  $('userName').textContent=user.user;
  $('bio').value = user.bio || '';
  if(user.avatar) $('avatar').src=user.avatar;
  loadScraps();
  loadFriends();
}

// Verifica se j√° existe um usu√°rio logado ao carregar a p√°gina
function checkLogin(){
  const savedUser = loadCurrentUser();
  if(savedUser){
    startApp(savedUser);
  }
}

// --- EVENT LISTENERS DE AUTENTICA√á√ÉO ---

// Registro
$('registerForm').onsubmit = e=>{
  e.preventDefault();
  const u=$('regUser').value.trim();
  const p=$('regPass').value;
  if(!u||!p){alert("Preencha todos os campos");return;}
  if(users.find(x=>x.user===u)){alert("Usu√°rio j√° existe");return;}
  // Inicializa o novo usu√°rio com campos vazios/padr√£o
  users.push({user:u,pass:p,avatar:'',scraps:[],bio:'',friends:[]});
  save(USERS_KEY,users);
  alert("Conta criada! Fa√ßa login.");
  e.target.reset();
};

// Login
$('loginForm').onsubmit = e=>{
  e.preventDefault();
  const u=$('logUser').value;
  const p=$('logPass').value;
  const usr = users.find(x=>x.user===u && x.pass===p);
  if(!usr){alert("Usu√°rio ou senha incorretos");return;}
  startApp(usr);
};

// Logout
$('logout').onclick = ()=>{
  currentUser=null;
  localStorage.removeItem('currentUser'); // Limpa o login persistente
  $('app').classList.add('hidden');
  $('auth').classList.remove('hidden');
};

// --- FUNCIONALIDADES DO PERFIL ---

// Avatar
$('imgUpload').onchange = e=>{
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload = ()=>{
      $('avatar').src=reader.result;
      currentUser.avatar=reader.result;
      updateUser(currentUser);
    };
    reader.readAsDataURL(file);
  }
};

// Bio
$('bio').onblur = ()=>{
  currentUser.bio = $('bio').value;
  updateUser(currentUser);
};

// Dark Mode
$('themeBtn').onclick = ()=>{
  document.body.classList.toggle('dark');
};

// --- FUNCIONALIDADE SCRAPS ---

// Cria e exibe um scrap
function addScrap(text,user=currentUser.user,saveIt=true){
  const d=document.createElement('div');
  d.className='scrap';
  d.innerHTML=`<strong>${user}</strong>: ${text}`;
  const btns = document.createElement('div'); btns.className='scrap-buttons';
  const likeBtn = document.createElement('button'); let likes=0;
  likeBtn.textContent='‚ù§Ô∏è 0';
  likeBtn.onclick=()=>{likes++; likeBtn.textContent=`‚ù§Ô∏è ${likes}`;}
  btns.appendChild(likeBtn);
  d.appendChild(btns);
  $('scraps').prepend(d); // Adiciona no topo
  if(saveIt){
    // Salva o scrap no perfil do usu√°rio atual
    currentUser.scraps.unshift({text,user});
    updateUser(currentUser);
  }
}
$('scrapForm').onsubmit=e=>{
  e.preventDefault();
  const t=$('scrapText').value.trim();
  if(t){addScrap(t); e.target.reset();}
};
function loadScraps(){
  $('scraps').innerHTML='';
  // Carrega os scraps do usu√°rio atual
  currentUser.scraps.forEach(s=>addScrap(s.text,s.user,false));
}

// --- FUNCIONALIDADE AMIGOS ---

// Carrega e exibe a lista de amigos
function loadFriends(){
  $('friendList').innerHTML='';
  currentUser.friends.forEach(f=>{
    const li = document.createElement('li');
    li.textContent=`üêà ${f}`;
    $('friendList').appendChild(li);
  });
}

// Adiciona Amigo
$('addFriendForm').onsubmit = e => {
  e.preventDefault();
  const friendName = $('friendInput').value.trim();

  if (!friendName || friendName === currentUser.user) {
    alert("N√£o pode adicionar a si mesmo!");
    return;
  }

  if (currentUser.friends.includes(friendName)) {
    alert(`${friendName} j√° √© seu amigo!`);
    return;
  }

  // Verifica se o usu√°rio a ser adicionado realmente existe no banco de dados
  const friendExists = users.some(u => u.user === friendName);

  if (friendExists) {
    currentUser.friends.push(friendName);
    updateUser(currentUser);
    loadFriends();
    $('friendInput').value = '';
    alert(`${friendName} adicionado(a) como amigo(a)!`);
  } else {
    alert(`Gatinho(a) ${friendName} n√£o encontrado(a) no Catkut.`);
  }
};


// INICIALIZA√á√ÉO
checkLogin();
</script>
</body>
  </html>
